<extend name="Public/base"/>

<block name="body">
<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
    <script type="text/javascript" src="__JS__/myQuery.js"></script>
    <div class="main-title">
        <h2>添加轮播图</h2>
    </div>
    <input type="hidden" value="{:U('Admin/silder/img_del')}" id="img_url">
    <form action="{:U(Admin/silder/add)}" method="post" class="form-horizontal">
        <!-- <div class="form-item" id="tab1">
            <div class="controls">
               <label class="item-label">广告图</label>
                        <input type="file" id="upload_picture">
                        <input type="hidden" name="icon" id="icon" value="{$info['icon']|default=''}"/>
                        <div class="upload-img-box">
                        <notempty name="info['icon']">
                            <div class="upload-pre-item"><img src="__ROOT__{$info.icon|get_cover='path'}"/></div>
                        </notempty>
                        </div>
            </div>
        </div>
<script type="text/javascript">
                    //上传图片
                    /* 初始化上传插件 */
                    $("#upload_picture").uploadify({
                        "height"          : 30,
                        "swf"             : "__STATIC__/uploadify/uploadify.swf",
                        "fileObjName"     : "download",
                        "buttonText"      : "上传图片",
                        "uploader"        : "{:U('File/uploadPicture',array('session_id'=>session_id()))}",
                        "width"           : 120,
                        'removeTimeout'   : 1,
                        'fileTypeExts'    : '*.jpg; *.png; *.gif;',
                        "onUploadSuccess" : uploadPicture,
                        'onFallback' : function() {
                            alert('未检测到兼容版本的Flash.');
                        }
                    });
                    function uploadPicture(file, data){
                        var data = $.parseJSON(data);
                        var src = '';
                        if(data.status){
 
                            $_img_path = $("<input type='hidden' name='icon[]' class='icon' value='' />");

                            $_img_path.val(data.id);

                            $("#tab1").append($_img_path);

                            src = data.url || '__ROOT__' + data.path;

                            $_upload_img = $("<img src="+src+" title='点击显示大图'>");
                            $_img_del = $("<span class='btn-close' title='删除图片'></span>");

                            $_upload_item = $("<div class='upload-pre-item'></div>");

                            $_upload_item.append($_upload_img);
                            $_upload_item.append($_img_del);

                            $(".icon").parent().find('.upload-img-box').append($_upload_item);
                        } else {
                            updateAlert(data.info);
                            setTimeout(function(){
                                $('#top-alert').find('button').click();
                                $(that).removeClass('disabled').prop('disabled',false);
                            },1500);
                        }
                    }
                    </script> -->

<!-- 111111111 -->
                                <div class="form-item">
                                    <label class="item-label">上传轮播<span class="check-tips">（尺寸:1920px * 500px）</span></label>
                                    <div class="controls">
                                        <input type="file" id="upload_picture_{$field.name}">
                                        <input type="hidden" name="pic_id" id="cover_id_{$field.name}" value="{$data[$field['name']]}"/>
                                    <div class="upload-img-box">
                                        <notempty name="data[$field['name']]">
                                            <div class="upload-pre-item"><img src="{$data[$field['name']]|get_cover='path'}"/></div>
                                        </notempty>
                                    </div>
                                    </div>
                                </div>
                                <script type="text/javascript">
                                //上传图片
                                /* 初始化上传插件 */
                                $("#upload_picture_{$field.name}").uploadify({
                                    "height"          : 30,
                                    "swf"             : "__STATIC__/uploadify/uploadify.swf",
                                    "fileObjName"     : "download",
                                    "buttonText"      : "上传图片",
                                    "uploader"        : "{:U('File/uploadPicture',array('session_id'=>session_id()))}",
                                    "width"           : 120,
                                    'removeTimeout'   : 1,
                                    'fileTypeExts'    : '*.jpg; *.png; *.gif;',
                                    "onUploadSuccess" : uploadPicture{$field.name},
                                    'onFallback' : function() {
                                        alert('未检测到兼容版本的Flash.');
                                    }
                                });
                                function uploadPicture{$field.name}(file, data){
                                    var data = $.parseJSON(data);
                                    var src = '';
                                    if(data.status){
                                        $("#cover_id_{$field.name}").val(data.id);
                                        src = data.url || '__ROOT__' + data.path
                                        $("#cover_id_{$field.name}").parent().find('.upload-img-box').html(
                                            '<div class="upload-pre-item"><img src="' + src + '"/></div>'
                                        );
                                    } else {
                                        updateAlert(data.info);
                                        setTimeout(function(){
                                            $('#top-alert').find('button').click();
                                            $(that).removeClass('disabled').prop('disabled',false);
                                        },1500);
                                    }
                                }
                                </script>
<!-- 11111111 -->
        <div class="form-item">
            <label class="item-label">标题<span class="check-tips">（添加轮播图标题）</span></label>
            <div class="controls">
                <input type="text" class="text input-large" name="title" value="">
            </div>
        </div>
        <div class="form-item">
            <button class="btn submit-btn ajax-post" id="submit" type="submit" target-form="form-horizontal">确 定</button>
            <button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
        </div>
    </form>
</block>

<block name="script">
    <script type="text/javascript">
        //导航高亮
        highlight_subnav('{:U('User/index')}');
    </script>
</block>
